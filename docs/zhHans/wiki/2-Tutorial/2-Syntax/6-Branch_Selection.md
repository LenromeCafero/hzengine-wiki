# 选择分支

在一部互动小说中，经常会让玩家选择选项，来将故事引向不同发展和结局。

例如，

<figure><img src="/static/image/dae5310c0522805fe9abbe31a9b8ae80 (1).png" alt=""><figcaption><p>选择分支</p></figcaption></figure>

以上这种通过让玩家选择一个按钮来触发不同分支剧情，叫做选择分支。

在 HZengine Script 中，选择分支用 menu 语句实现。

## menu 语句

这是我们学习的第一个多行语句。它由三种命令组成：

`menu` 开始命令，标志着一个选择分支菜单的开始；

`@"<按钮内容>"` 选项命令，用来为菜单声明一个按钮；

`end menu` 结束命令，标志着一个选项分支菜单的结束。

每个 menu 语句必须包含一个开始命令和一个结束命令，以及一个或多个选项命令。选项命令必须出现在开始和结束命令之间。

以下是一个例子

```renpy
"女仆酱" "欢迎来到星光咖啡馆！你想喝点什么呢？"

menu  # 开始命令

@"酱香拿铁"  # 声明一个按钮
    "女仆酱" "客官眼光真好，这是我们推出的新品。酱香科技拿铁！"
    
@"冰美式"
    "女仆酱" "什么？！美式这种苦苦的东西真是人喝的？!"
    
@"你"
    "女仆酱" "呃呃这是不可能的"
    "女仆酱" "转身~ 慢走不送~"
    
end menu  # 结束命令
```

这段脚本会显示一个如开头图片所示的选择分支菜单。当玩家选择了对应的按钮时，会跳转到对应的 @ 语句下开始执行，直到下一个 @ 语句出现为止。

如果按钮文字不包含空格，可以省略双引号，但@和文字之间要有空格。

### 缩进与代码风格

这里有个小细节，我们在 menu 语句中的命令前加了几个空格，这叫做缩进。缩进在 HZengine 中不是必须的，但它可以增加代码的可读性，尤其是当你嵌套多个多行语句时。这纯粹是一种代码风格，加不加前导空格、加多少个，取决于你的喜好。富有经验的创作者通常会形成一套自己的代码风格，在 HZengine Script 也好，在其它编程语言中也好。

此外，我们用空行分隔了选项，也能增加代码的美观性，同样不是必须的。

## 使用脚本标签和跳转语句降低脚本复杂度

当故事变得复杂时，一个分支下就可能有几百上千行对话，如果将它们全部写在 menu 语句中，会让脚本变得难读、易错。设想一下，你正在编辑一个 hzs 剧本，你面前的是一个分支中的几百行对话。如果你想编辑这个分支对应的按钮，可能要划半天才能找到；你忘记了有没有写 end menu，想往下找却不小心划到了 menu 语句以外的地方...&#x20;

一个好的解决方法是将分支剧情放在单独的 label 标签下。

比如

```renpy
"我应该去哪里呢"
menu
@"坐火车回乡下"
    jump 乡下
@"留在这里"
    jump 留在这里
end menu

* 乡下
# ...
# 此处省略几百行
# ...

* 留在这里
# ...
# 此处省略几百行
# ...
```

这样，menu 语句就变得简短易读了。你还可以把分出去的 label 标签放在其它文件下，取决于语句的多少和你的偏好。

## 嵌套使用 menu 语句

menu 语句支持嵌套使用。

下面是一个例子

```renpy
"选择一件衣服"
menu
@"衬衫"
    "请选择衬衫的颜色"
    menu
    @"淡蓝色"
        "你选择了一件淡蓝色的衬衫"
    @"白色"
        "你选择了一件白色的衬衫"
    end menu
@"大衣"
    # ... 懒得写了
end menu
```

这会在你选择完衬衫或大衣后，进一步选择其颜色。嵌套的 menu 语句适用于连续复杂的选择分支。

请注意，每个 menu 命令都需要有一个对应的 end menu 命令，否则将报错。出现 @ 命令时，HZengine 会将它归为最内层的 menu 语句中（使用缩进可以让嵌套语句更加直观）

## 条件展示某个选项（已实装，未测试）

这可以让 HZengine 根据表达式求值结果选择性展示一个选项。

请先确保你已经学习过 变量 这章。

条件展示的语法为

`@"<按钮文字>" enable={<表达式>}`&#x20;

当表达式的结果为 true 时，按钮会被显示出来；当表达式的结果为 false 时，按钮会被隐藏。可以用于剧情锁等需要玩家达成一定条件才能解锁特定分支的情况。

表达式的结果必须是一个布尔值，否则将引发错误。

注意，enable后面的等号前后不能有空格，否则将解析失败（后期将修复）

请等待开发组测试该功能后再使用。
